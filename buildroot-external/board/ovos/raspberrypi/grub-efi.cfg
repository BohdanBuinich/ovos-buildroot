set default="0"
set fallback="1"
set timeout="1"
set MACHINE_ID=""

if [ "$MACHINE_ID" == "" ]; then
    boot_condition="systemd.condition-first-boot=true"
fi

set menu_color_normal=white/black
set menu_color_highlight=white/red

load_env

default_cmdline="rootfstype=squashfs init=/sbin/pre-init systemd.machine_id=$MACHINE_ID fsck.repair=yes zram.enabled=1 zram.num_devices=3 console=tty1 systemd.unified_cgroup_hierarchy=1 cgroup_enable=cpuset cgroup_memory=1 audit=0 $boot_condition rootwait"
file_env -f ($root)/cmdline.txt cmdline

regexp --set 1:boothd (.+),.+ ${root}

menuentry "OpenVoiceOS - Slot A" {
  linux (${boothd},gpt2)/boot/Image root=PARTUUID=c0932a41-44cf-463b-8152-d43188553ed4 ro $default_cmdline $cmdline
}

menuentry "OpenVoiceOS - Slot B" {
  linux (${boothd},gpt3)/boot/Image root=PARTUUID=3adea996-45ad-4928-920e-ffb5aedd00cb ro $default_cmdline $cmdline
}

menuentry "OpenVoiceOS - Slot A (Rescue shell)" {
  linux (${boothd},gpt2)/boot/Image root=PARTUUID=c0932a41-44cf-463b-8152-d43188553ed4 ro $default_cmdline $cmdline systemd.unit=rescue.target
}

menuentry "OpenVoiceOS - Slot B (Rescue shell)" {
  linux (${boothd},gpt3)/boot/Image root=PARTUUID=3adea996-45ad-4928-920e-ffb5aedd00cb ro $default_cmdline $cmdline systemd.unit=rescue.target
}
